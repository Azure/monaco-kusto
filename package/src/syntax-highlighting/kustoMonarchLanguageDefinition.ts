import type * as monaco from 'monaco-editor';
import { LANGUAGE_ID } from '../globals';
import { Tokens } from './types';

const promotedOperatorCommandTokens = [
    'where',
    'count',
    'extend',
    'join',
    'limit',
    'order',
    'project',
    'project-away',
    'project-rename',
    'project-reorder',
    'project-keep',
    'render',
    'sort',
    'summarize',
    'distinct',
    'take',
    'top',
    'top-nested',
    'top-hitters',
    'union',
    'mv-expand',
    'mv-apply',
    'reduce',
    'evaluate',
    'parse',
    'parse-where',
    'parse-kv',
    'sample',
    'sample-distinct',
    'make-series',
    'getschema',
    'serialize',
    'invoke',
    'as',
    'scan',
    'make-graph',
    'graph-match',
    'graph-to-table',
    'graph-merge',
];

const commands = [
    '.add',
    '.alter',
    '.alter-merge',
    '.attach',
    '.append',
    '.create',
    '.create-merge',
    '.create-set',
    '.create-or-alter',
    '.define',
    '.detach',
    '.delete',
    '.drop',
    '.drop-pretend',
    '.dup-next-ingest',
    '.dup-next-failed-ingest',
    '.ingest',
    '.export',
    '.load',
    '.move',
    '.purge',
    '.purge-cleanup',
    '.remove',
    '.replace',
    '.save',
    '.set',
    '.set-or-append',
    '.set-or-replace',
    '.show',
    '.rename',
    '.run',
];

export const kustoLanguageDefinition: monaco.languages.IMonarchLanguage = {
    name: LANGUAGE_ID,
    mimeTypes: ['text/kusto'],
    displayName: 'Kusto',
    defaultToken: 'invalid',
    promotedOperatorCommandTokens,
    commands,
    tokenizer: {
        root: [
            [/(\/\/.*$)/, Tokens.Comment],
            [/[\(\)\{\}\|\[\]\:\=\,]/, Tokens.Punctuation],
            [/"([^"\\]*(\\.[^"\\]*)*)"/, Tokens.StringLiteral],
            [
                /[\w@#\-$\.]+/,
                {
                    cases: {
                        '@promotedOperatorCommandTokens': Tokens.QueryOperator,
                        '@commands': Tokens.Command,
                        '@default': 'identifier',
                    },
                },
            ],
        ],
    },
};
